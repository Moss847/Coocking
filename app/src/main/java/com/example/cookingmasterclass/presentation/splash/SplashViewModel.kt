package com.example.cookingmasterclass.presentation.splash

import android.content.Context
import android.graphics.Bitmap
import android.graphics.drawable.BitmapDrawable
import android.os.Environment
import androidx.lifecycle.ViewModel
import com.example.cookingmasterclass.R
import com.example.cookingmasterclass.data.local.room.RecipeDatabase
import com.example.cookingmasterclass.domain.models.Difficulty
import com.example.cookingmasterclass.domain.models.Recipe
import dagger.hilt.android.lifecycle.HiltViewModel
import dagger.hilt.android.qualifiers.ApplicationContext
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.io.IOException
import java.text.SimpleDateFormat
import java.util.Date
import javax.inject.Inject

@HiltViewModel
class SplashViewModel @Inject constructor(
    val recipeDatabase: RecipeDatabase,
    @ApplicationContext val context: Context
) : ViewModel() {


    suspend fun load() {
        withContext(Dispatchers.IO) {
            if (recipeDatabase.recipeDao().getCount() == 0)
                createRecipes().forEach {
                    recipeDatabase.recipeDao().insert(it)
                }
        }
    }

    private fun getPath(res: Int) =
        saveBitmapToFile(context, (context.getDrawable(res) as BitmapDrawable).bitmap)

    fun createRecipes() =
        listOf(
            Recipe(
                title = "Паста с томатным соусом",
                ingredients = listOf(
                    "Паста (спагетти или пенне) – 250 г",
                    "Томаты (консервированные или свежие) – 400 г",
                    "Лук – 1 шт.",
                    "Чеснок – 2 зубчика",
                    "Оливковое масло – 2 ст. ложки",
                    "Базилик (свежий или сушеный) – по вкусу",
                    "Соль, перец – по вкусу"
                ),
                photo = getPath(R.drawable._1),
                step = listOf(
                    "(0:00 - 10:00) Отварите пасту в подсоленной воде до состояния аль денте согласно инструкции на упаковке. Слейте воду и оставьте немного воды от пасты.",
                    "(10:00 - 15:00) В сковороде разогрейте оливковое масло на среднем огне. Добавьте нарезанный лук и обжаривайте до прозрачности (около 5 минут).",
                    "(15:00 - 17:00) Добавьте мелко нарезанный чеснок и обжаривайте еще 1-2 минуты пока не появится аромат.",
                    "(17:00 - 32:00) Добавьте нарезанные томаты соль перец и базилик. Тушите соус на среднем огне 10-15 минут пока он не загустеет.",
                    "(32:00 - 35:00) Смешайте пасту с соусом добавив немного воды от пасты если соус слишком густой. Подавайте горячим."
                ),
                difficulty = Difficulty.Easy,
                cookingTime = 30
            ),
            Recipe(
                title = "Куриное филе с овощами",
                ingredients = listOf(
                    "Куриное филе – 400 г",
                    "Болгарский перец – 1 шт.",
                    "Брокколи – 200 г",
                    "Морковь – 1 шт.",
                    "Соевый соус – 3 ст. ложки",
                    "Специи (по вкусу) – паприка, черный перец, соль",
                    "Растительное масло – 2 ст. ложки"
                ),
                photo = getPath(R.drawable._2),
                step = listOf(
                    "(0:00 - 7:00) Нарежьте куриное филе на кусочки. В сковороде разогрейте растительное масло и обжарьте курицу до золотистой корочки (около 5-7 минут).",
                    "(7:00 - 10:00) Нарежьте болгарский перец и морковь разделите брокколи на соцветия.",
                    "(10:00 - 17:00) Добавьте овощи к курице и обжаривайте еще 5-7 минут пока они не станут мягкими.",
                    "(17:00 - 20:00) Влейте соевый соус добавьте специи и тушите еще 5 минут. Подавайте горячим."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 40
            ),
            Recipe(
                title = "Овощной суп",
                ingredients = listOf(
                    "Картофель – 2 шт.",
                    "Морковь – 1 шт.",
                    "Лук – 1 шт.",
                    "Сельдерей – 1 стебель",
                    "Овощной бульон – 1,5 л",
                    "Зелень (петрушка, укроп) – по вкусу",
                    "Соль, перец – по вкусу",
                    "Растительное масло – 1 ст. ложка"
                ),
                photo = getPath(R.drawable._3),
                step = listOf(
                    "(0:00 - 5:00) В кастрюле разогрейте растительное масло добавьте нарезанный лук и обжаривайте до мягкости (около 5 минут).",
                    "(5:00 - 10:00) Добавьте нарезанные картофель морковь и сельдерей. Обжаривайте 5 минут.",
                    "(10:00 - 55:00) Влейте овощной бульон и доведите до кипения. Уменьшите огонь и варите 30-35 минут до готовности овощей.",
                    "(55:00 - 60:00) Добавьте нарезанную зелень соль и перец по вкусу. Подавайте горячим."
                ),
                difficulty = Difficulty.Easy,
                cookingTime = 45
            ),
            Recipe(
                title = "Шоколадный торт",
                ingredients = listOf(
                    "Мука – 200 г",
                    "Сахар – 200 г",
                    "Какао-порошок – 50 г",
                    "Яйца – 3 шт.",
                    "Масло (растопленное) – 100 г",
                    "Разрыхлитель – 1 ч. ложка",
                    "Молоко – 200 мл",
                    "Соль – щепотка"
                ),
                photo = getPath(R.drawable._4),
                step = listOf(
                    "(0:00 - 10:00) Разогрейте духовку до 180°C. Смажьте форму для выпечки маслом и присыпьте мукой.",
                    "(10:00 - 15:00) В миске смешайте муку сахар какао разрыхлитель и соль.",
                    "(15:00 - 20:00) В другой миске взбейте яйца добавьте растопленное масло и молоко. Соедините обе смеси и перемешайте до однородности.",
                    "(20:00 - 25:00) Вылейте тесто в форму и выпекайте 30-35 минут. Проверьте готовность деревянной шпажкой: она должна выходить сухой.",
                    "(25:00 - 35:00) Дайте торту остыть в форме 10 минут затем аккуратно извлеките и остудите на решетке.",
                    "(35:00 - 40:00) По желанию торт можно покрыть глазурью из растопленного шоколада или посыпать сахаром."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 60
            ),
            Recipe(
                title = "Салат Цезарь",
                ingredients = listOf(
                    "Салат романо – 1 кочан",
                    "Куриное филе – 200 г",
                    "Пармезан – 50 г",
                    "Гренки – 100 г",
                    "Соус Цезарь – 4 ст. ложки",
                    "Оливковое масло – 1 ст. ложка",
                    "Соль, перец – по вкусу"
                ),
                photo = getPath(R.drawable._5),
                step = listOf(
                    "(0:00 - 10:00) Обжарьте куриное филе на сковороде с оливковым маслом до золотистой корочки. Посолите и поперчите по вкусу. Дайте остыть и нарежьте.",
                    "(10:00 - 15:00) В большой миске порвите листья салата на кусочки. Добавьте нарезанное куриное филе и гренки.",
                    "(15:00 - 20:00) Полейте соусом Цезарь и аккуратно перемешайте.",
                    "(20:00 - 25:00) Перед подачей посыпьте тертым пармезаном."
                ),
                difficulty = Difficulty.Easy,
                cookingTime = 20
            ),
            Recipe(
                title = "Блины с начинкой",
                ingredients = listOf(
                    "Мука – 250 г",
                    "Молоко – 500 мл",
                    "Яйца – 2 шт.",
                    "Сахар – 2 ст. ложки",
                    "Начинка (творог, мясо, грибы) – по вкусу",
                    "Соль – щепотка",
                    "Масло растительное – для жарки"
                ),
                photo = getPath(R.drawable._6),
                step = listOf(
                    "(0:00 - 5:00) В миске смешайте муку молоко яйца сахар и щепотку соли. Взбейте до однородной массы.",
                    "(5:00 - 10:00) Разогрейте сковороду с небольшим количеством масла. Вылейте порцию теста и жарьте с обеих сторон до золотистого цвета.",
                    "(10:00 - 30:00) Готовые блины складывайте на тарелку. Начините их выбранной начинкой сверните и подавайте."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 30
            ),
            Recipe(
                title = "Куриные котлеты",
                ingredients = listOf(
                    "Куриный фарш – 500 г",
                    "Лук – 1 шт.",
                    "Яйцо – 1 шт.",
                    "Панировочные сухари – 100 г",
                    "Специи (соль, перец) – по вкусу",
                    "Масло растительное – для жарки"
                ),
                photo = getPath(R.drawable._7),
                step = listOf(
                    "(0:00 - 5:00) В миске смешайте куриный фарш мелко нарезанный лук яйцо соль и перец. Хорошо перемешайте.",
                    "(5:00 - 10:00) Сформируйте котлеты и обваляйте их в панировочных сухарях.",
                    "(10:00 - 15:00) Разогрейте сковороду с растительным маслом и обжаривайте котлеты с обеих сторон до золотистой корочки (около 5-7 минут с каждой стороны).",
                    "(15:00 - 20:00) Подавайте горячими с гарниром или салатом."
                ),
                difficulty = Difficulty.Easy,
                cookingTime = 30
            ),
            Recipe(
                title = "Пирог с яблоками",
                ingredients = listOf(
                    "Мука – 250 г",
                    "Сахар – 150 г",
                    "Яблоки – 3-4 шт. (кисло-сладкие)",
                    "Корица – 1 ч. ложка",
                    "Масло (сливочное) – 100 г",
                    "Яйца – 2 шт.",
                    "Разрыхлитель теста – 1 ч. ложка",
                    "Соль – щепотка"
                ),
                photo = getPath(R.drawable._8),
                step = listOf(
                    "(0:00 - 10:00) В миске смешайте муку сахар разрыхлитель и соль. Добавьте размягченное сливочное масло и яйца. Замесите тесто до однородной консистенции.",
                    "(10:00 - 15:00) Заверните тесто в пленку и уберите в холодильник на 30 минут.",
                    "(15:00 - 25:00) Яблоки очистите от кожуры удалите сердцевину и нарежьте тонкими дольками. Смешайте с сахаром и корицей.",
                    "(25:00 - 30:00) Разогрейте духовку до 180°C. Раскатайте тесто и выложите его в форму для выпечки оставив немного для верха.",
                    "(30:00 - 40:00) Выложите яблоки на тесто накройте оставшимся тестом и сделайте несколько надрезов для выхода пара.",
                    "(40:00 - 60:00) Выпекайте 40-50 минут до золотистой корочки. Дайте остыть перед подачей."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 60
            ),
            Recipe(
                title = "Тайский карри с кокосовым молоком",
                ingredients = listOf(
                    "Куриное филе – 400 г",
                    "Кокосовое молоко – 400 мл",
                    "Карри паста – 2-3 ст. ложки (по вкусу)",
                    "Овощи (брокколи, морковь, перец) – 300 г",
                    "Рис – 200 г",
                    "Растительное масло – 2 ст. ложки",
                    "Соль – по вкусу"
                ),
                photo = getPath(R.drawable._9),
                step = listOf(
                    "(0:00 - 5:00) Отварите рис согласно инструкции на упаковке. Обычно это занимает около 15-20 минут.",
                    "(5:00 - 10:00) В сковороде разогрейте растительное масло на среднем огне. Добавьте нарезанное куриное филе и обжаривайте до золотистой корочки (около 5-7 минут).",
                    "(10:00 - 12:00) Добавьте карри пасту и обжаривайте еще 1-2 минуты чтобы раскрыть аромат.",
                    "(12:00 - 15:00) Влейте кокосовое молоко и доведите до кипения.",
                    "(15:00 - 35:00) Уменьшите огонь и добавьте нарезанные овощи. Тушите на среднем огне 15-20 минут пока овощи не станут мягкими. Посолите по вкусу.",
                    "(35:00 - 40:00) Подавайте карри с отварным рисом."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 40
            ),
            Recipe(
                title = "Пирог с вишней",
                ingredients = listOf(
                    "Мука – 250 г",
                    "Сахар – 150 г",
                    "Вишня (свежая или замороженная) – 300 г",
                    "Яйца – 2 шт.",
                    "Масло (сливочное) – 100 г",
                    "Разрыхлитель теста – 1 ч. ложка",
                    "Соль – щепотка"
                ),
                photo = getPath(R.drawable._10),
                step = listOf(
                    "(0:00 - 10:00) В миске смешайте муку сахар разрыхлитель и соль. Добавьте размягченное сливочное масло и яйца. Замесите тесто до однородной консистенции.",
                    "(10:00 - 15:00) Заверните тесто в пленку и уберите в холодильник на 30 минут.",
                    "(15:00 - 25:00) Вишню промойте и если используете замороженную дайте ей оттаять. Если вишня с косточками удалите их.",
                    "(25:00 - 30:00) Разогрейте духовку до 180°C. Раскатайте тесто и выложите его в форму для выпечки оставив немного для верха.",
                    "(30:00 - 40:00) Выложите вишню на тесто накройте оставшимся тестом и сделайте несколько надрезов для выхода пара.",
                    "(40:00 - 60:00) Выпекайте 40-50 минут до золотистой корочки. Дайте остыть перед подачей."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 60
            ),
            Recipe(
                title = "Греческий салат",
                ingredients = listOf(
                    "Помидоры – 3-4 шт.",
                    "Огурцы – 2 шт.",
                    "Красный лук – 1 шт.",
                    "Оливки – 100 г",
                    "Фета – 150 г",
                    "Оливковое масло – 3 ст. ложки",
                    "Орегано – по вкусу"
                ),
                photo = getPath(R.drawable._11),
                step = listOf(
                    "(0:00 - 5:00) Помидоры и огурцы нарежьте кубиками. Красный лук нарежьте тонкими полукольцами.",
                    "(5:00 - 10:00) В глубокой миске смешайте нарезанные овощи добавьте оливки и нарезанную кубиками фету.",
                    "(10:00 - 12:00) Полейте салат оливковым маслом и посыпьте орегано.",
                    "(12:00 - 15:00) Аккуратно перемешайте все ингредиенты и подавайте к столу."
                ),
                difficulty = Difficulty.Easy,
                cookingTime = 15
            ),
            Recipe(
                title = "Котлеты по-киевски",
                ingredients = listOf(
                    "Куриное филе – 500 г",
                    "Сливочное масло – 100 г",
                    "Зелень (петрушка, укроп) – по вкусу",
                    "Панировочные сухари – 100 г",
                    "Яйца – 2 шт."
                ),
                photo = getPath(R.drawable._12),
                step = listOf(
                    "(0:00 - 10:00) Куриное филе нарежьте на порционные куски и отбейте.",
                    "(10:00 - 20:00) В миске смешайте размягченное сливочное масло с мелко нарезанной зеленью.",
                    "(20:00 - 30:00) На каждый кусок филе положите немного масляной смеси заверните и зафиксируйте зубочистками.",
                    "(30:00 - 40:00) Обваляйте котлеты в муке затем в взбитых яйцах и панировочных сухарях.",
                    "(40:00 - 60:00) Обжарьте котлеты на сковороде с разогретым маслом до золотистой корочки с обеих сторон. Подавайте горячими."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 60
            ),
            Recipe(
                title = "Рататуй",
                ingredients = listOf(
                    "Баклажаны – 1 шт.",
                    "Цукини – 1 шт.",
                    "Помидоры – 3 шт.",
                    "Перец (болгарский) – 1 шт.",
                    "Лук – 1 шт.",
                    "Чеснок – 2 зубчика",
                    "Оливковое масло – 3 ст. ложки",
                    "Прованские травы – по вкусу"
                ),
                photo = getPath(R.drawable._13),
                step = listOf(
                    "(0:00 - 10:00) Баклажан нарежьте кубиками посолите и оставьте на 10 минут, чтобы вышла горечь. Затем промойте и обсушите.",
                    "(10:00 - 20:00) Цукини помидоры и болгарский перец нарежьте кубиками. Лук и чеснок мелко нарежьте.",
                    "(20:00 - 30:00) В глубокой сковороде разогрейте оливковое масло. Обжарьте лук и чеснок до прозрачности.",
                    "(30:00 - 40:00) Добавьте баклажаны и обжаривайте 5-7 минут пока они не станут мягкими.",
                    "(40:00 - 50:00) Затем добавьте цукини и перец обжаривайте еще 5-7 минут.",
                    "(50:00 - 60:00) В конце добавьте помидоры и прованские травы. Тушите на среднем огне 10-15 минут пока овощи не станут мягкими. Подавайте горячим или холодным."
                ),
                difficulty = Difficulty.Medium,
                cookingTime = 60
            ),
            Recipe(
                title = "Печеная рыба с лимоном и зеленью",
                ingredients = listOf(
                    "Рыба (например, форель) – 2 шт.",
                    "Лимон – 1 шт.",
                    "Зелень (петрушка, укроп) – по вкусу",
                    "Оливковое масло – 2 ст. ложки",
                    "Соль – по вкусу",
                    "Перец – по вкусу"
                ),
                photo = getPath(R.drawable._14),
                step = listOf(
                    "(0:00 - 5:00) Рыбу тщательно промойте и обсушите. Удалите внутренности если это необходимо.",
                    "(5:00 - 10:00) Натрите рыбу солью и перцем как внутри так и снаружи.",
                    "(10:00 - 15:00) Лимон нарежьте кружочками. Внутрь рыбы положите несколько кружочков лимона и нарезанную зелень.",
                    "(15:00 - 20:00) Смажьте рыбу оливковым маслом снаружи.",
                    "(20:00 - 25:00) Разогрейте духовку до 200°C. Заверните рыбу в фольгу и поместите на противень.",
                    "(25:00 - 30:00) Запекайте рыбу в духовке 20-25 минут. Подавайте горячей украсив оставшимися кружочками лимона и зеленью."
                ),
                difficulty = Difficulty.Easy,
                cookingTime = 30
            )
        )
}


@Throws(IOException::class)
fun createImageFile(context: Context, onSave: (String) -> Unit): File {
    val fileName = SimpleDateFormat("yyyyMMdd_HHmm").format(Date())
    val storageDir: File? = context.getExternalFilesDir(Environment.DIRECTORY_PICTURES)
    return File.createTempFile(fileName, ".jpg", storageDir).apply {
        onSave(absolutePath)
    }
}

fun saveBitmapToFile(context: Context, bitmap: Bitmap): String {
    var fileName = ""
    val file = createImageFile(context, onSave = { fileName = it })
    val outputStream = FileOutputStream(file)
    bitmap.compress(Bitmap.CompressFormat.JPEG, 90, outputStream)
    outputStream.flush()
    outputStream.close()
    return fileName
}
